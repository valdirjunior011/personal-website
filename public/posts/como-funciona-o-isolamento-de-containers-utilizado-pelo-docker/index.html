<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  How Docker Uses Linux Kernel Features to Isolate Containers Â· Valdir Junior
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Valdir Junior">
<meta name="description" content="understanding how Docker uses Linux kernel features like CGroups, Namespaces, and Unshare to isolate containers.">
<meta name="keywords" content="devops, cloud, kubernetes, docker, linux, ansible, terraform, python, aws, azure">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How Docker Uses Linux Kernel Features to Isolate Containers">
  <meta name="twitter:description" content="understanding how Docker uses Linux kernel features like CGroups, Namespaces, and Unshare to isolate containers.">

<meta property="og:url" content="http://localhost:1313/posts/como-funciona-o-isolamento-de-containers-utilizado-pelo-docker/">
  <meta property="og:site_name" content="Valdir Junior">
  <meta property="og:title" content="How Docker Uses Linux Kernel Features to Isolate Containers">
  <meta property="og:description" content="understanding how Docker uses Linux kernel features like CGroups, Namespaces, and Unshare to isolate containers.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-01-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-01-02T00:00:00+00:00">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="CGroups">
    <meta property="article:tag" content="Namespaces">
    <meta property="article:tag" content="Unshare">




<link rel="canonical" href="http://localhost:1313/posts/como-funciona-o-isolamento-de-containers-utilizado-pelo-docker/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Valdir Junior
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Publications</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Experience</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/valdir-junior.pdf">Curriculum</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="/pt-br/posts/como-funciona-o-isolamento-de-containers-utilizado-pelo-docker/">ðŸ‡§ðŸ‡·</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/como-funciona-o-isolamento-de-containers-utilizado-pelo-docker/">
              How Docker Uses Linux Kernel Features to Isolate Containers
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-01-02T00:00:00Z">
                January 2, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/devops/">DevOps</a>
      <span class="separator">â€¢</span>
    <a href="/categories/containers/">Containers</a>
      <span class="separator">â€¢</span>
    <a href="/categories/linux/">Linux</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/docker/">Docker</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/linux/">Linux</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/cgroups/">CGroups</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/namespaces/">Namespaces</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/unshare/">Unshare</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p><img src="https://media.licdn.com/dms/image/v2/D4E12AQHVJusYLjguHA/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1693822466067?e=1758758400&amp;v=beta&amp;t=bPRZ8xzT7u3DhwjV3quxfZMEjyDlriIElSfE-EKA2h0" alt=""></p>
<p>Docker has revolutionized the way applications are deployed and managed by using the concept of
containers. One of the fundamental pillars of this feature is isolation, which enables multiple
applications to run on a single host without interfering with one another. This isolation is
achieved through essential Linux kernel features such as Control Groups (CGroups), Namespaces, and
the unshare command. In this article, we will gain an understanding of these features and how they
are used to create isolated environments in Docker.</p>
<h3 id="instroduction-to-container-isolation-in-docker">
  Instroduction to Container Isolation in Docker
  <a class="heading-link" href="#instroduction-to-container-isolation-in-docker">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Isolation is crucial to ensure that containerized applications operate independently in a shared
environment. Without proper isolation, applications could conflict with each other, making
deployment more complex and risky.</p>
<p>To understand isolation in Docker, it is essential to be familiar with three key components:</p>
<ul>
<li><strong>Control Groups (CGroups)</strong></li>
</ul>
<p>Control Groups, or CGroups, is a feature that allows controlling and limiting the resources of a
process. Docker uses CGroups to enforce CPU, memory, I/O, and resource limits on containers. This
ensures that an application in one container does not monopolize all system resources, making the
enviroment more balanced and secure.</p>
<ul>
<li><strong>Namespaces</strong></li>
</ul>
<p>Namespaces provide isolation of system resources such as process, file systems, and networks. Docker
uses namespaces to create an isolated environment for each container. This means that each container
&ldquo;sees&rdquo; only its own processes, file systems, and network interfaces, creating the illusion that it
is running on a separete system.</p>
<ul>
<li><strong>Unshare</strong></li>
</ul>
<p>The <strong>Unshare</strong> command allows creating a new namespace for an existing process, enabling proceesses
to run in an isolated environment without the need for Docker or other contatiner managers. Unshare
is a powerful tool for experimentation, testing, and situations where you want to create a custom
container environment.</p>
<hr>
<h3 id="running-a-container-on-linux">
  Running a Container on Linux
  <a class="heading-link" href="#running-a-container-on-linux">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Let&rsquo;s now ecplore the steps required to create and run a container on Linux, using essential tools
and concepts such as <strong>CGroups</strong>, <strong>chroot</strong>, <strong>namespaces</strong>, <strong>unshare</strong>, and <strong>debootstrap</strong>.</p>
<h3 id="basic-concepts">
  Basic Concepts
  <a class="heading-link" href="#basic-concepts">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<ol>
<li><strong>CGroups (Control Groups)</strong>: Fundamental for resource management, allowing control over CPU,
memory&hellip;</li>
<li><strong>chroot</strong>: Changes the root directory of a process, allowing it to see only a specific
subdirectory as its root.</li>
<li><strong>Namespaces</strong>: Create isolated instances of system resources such as PID, network, file system,
and others.</li>
<li><strong>Unshare</strong>: The unshare command is used to create isolated namespaces for a process or group of
processes.</li>
<li><strong>Debootstrap</strong>: Is a tools that allows the creation of minimal toot file systems for Linux
distributions. It is commonly used to create initial file systems for containers.</li>
</ol>
<hr>
<h3 id="step-1-prepare-the-root-file-system">
  Step 1: Prepare the Root File System
  <a class="heading-link" href="#step-1-prepare-the-root-file-system">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>we will use <strong>debootstrap</strong> to create a minimal root file system. In this example, we&rsquo;ll use Ubuntu:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">sudo mkdir /container
</span></span><span class="line"><span class="cl">debootstrap focal /container http://archive.ubuntu.com/ubuntu/
</span></span></code></pre></div><h3 id="step-2-configure-resource-isolation">
  Step 2: Configure Resource Isolation
  <a class="heading-link" href="#step-2-configure-resource-isolation">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>We will use the unshare command to create PID, network, and file system namespaces for the
container:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">unshare --fork -- pid --mount-proc --uts --ipc --net --map-root-user
</span></span></code></pre></div><p><strong>What this line does:</strong> The unshare command creates a new process with isolated namespaces in
several areas of the system:</p>
<ol>
<li><strong>&ndash;fork</strong>: Instructs unshare to creaet new child process after isolating the namespaces. The
child process will run without any specific task right after the namespaces are created.</li>
<li><strong>&ndash;pid</strong>: Isolates the PID namespace, meaning the created process will have its own separate
process space from those outside the PID namespace.</li>
<li><strong>&ndash;moun-proc</strong>: Mounts an isolated /proc file system for the created process, giving it its own
view of /proc.</li>
<li><strong>&ndash;uts</strong>: Isolates the UTS namespace, which controls the hostname. This allows the created
process to have its own hostname.</li>
<li><strong>&ndash;ipc</strong>: Isolates the IPC namespace, which manages interprocess communication. this prevents
the created process form directly interacting with processes outside the IPC namespace.</li>
<li><strong>&ndash;net</strong>: Isolates the network namespace, meaning the created process will have its own separate
network stack and network settings.</li>
<li><strong>&ndash;map-root-user</strong>: Allows the created process to be treated as root (superuser) inside the
namespace, even without root permissions on the host system.</li>
</ol>
<h3 id="step-3-start-the-process-inseide-the-container">
  Step 3: Start the Process Inseide the Container
  <a class="heading-link" href="#step-3-start-the-process-inseide-the-container">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>within the chroot environment, you can start any desired processess. For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">chroot /container /bin/bash
</span></span></code></pre></div><h3 id="step-4-isolate-resource-usage-with-cgroups">
  Step 4: Isolate Resource Usage with CGroups
  <a class="heading-link" href="#step-4-isolate-resource-usage-with-cgroups">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>To limit the container&rsquo;s resource usage, you can create a control group (CGroup) for the container&rsquo;s
process and set limits using command like <code>cgcreate</code>, <code>cgset</code> and <code>cgexec</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl"><span class="c1">#Install the cgroups package to manipulate these resources</span>
</span></span><span class="line"><span class="cl">sudo apt install cgroups-tools
</span></span></code></pre></div><hr>
<h2 id="examples-of-running-a-container-using-the-concepts-mentioned">
  Examples of Running a Container Using the Concepts Mentioned
  <a class="heading-link" href="#examples-of-running-a-container-using-the-concepts-mentioned">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="example-1-create-a-simple-container">
  Example 1: Create a Simple Container
  <a class="heading-link" href="#example-1-create-a-simple-container">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Let&rsquo;s create a minimal Ubuntu container and run a shell inside it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl"><span class="c1"># Prepare the root file system</span>
</span></span><span class="line"><span class="cl">debootstrap focal /container http://archive.ubuntu.com/ubuntu/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configure resource isolation</span>
</span></span><span class="line"><span class="cl">unshare --fork --pid --mount-proc --uts --ipc --net --map-root-user chroot /container /bin/bash
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#Start the shell in the container</span>
</span></span><span class="line"><span class="cl">/bin/bash
</span></span></code></pre></div><h3 id="example-2-isolate-cpu-usage-with-cgroups">
  Example 2: Isolate CPU Usage with CGroups
  <a class="heading-link" href="#example-2-isolate-cpu-usage-with-cgroups">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Suppose you want to limit the container&rsquo;s CPU usage to 50%:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl"><span class="c1"># Create a control group for the container</span>
</span></span><span class="line"><span class="cl">cgcreate -g cpu:container_group
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set CPU limit to 50%</span>
</span></span><span class="line"><span class="cl">cgset -r cpu.cfs_quota_us<span class="o">=</span><span class="m">50000</span> container_group
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run the container process</span>
</span></span><span class="line"><span class="cl">cgexec -g cpu:container_group /bin/bash
</span></span></code></pre></div><hr>
<h2 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>This article explored, in a basic and simple way, the fundamentals of creating and running
containers on Linux using tools such as cgroups, chroot, namespaces, unshare, and debootstrap. These
techniques allow processes to be isolated in independent environments, which is the essential
foundation of containerization.</p>
<p>However, it is important to note that tools like Docker greatly simplify the creation and management
of containers. Behind the scenes, these tools combine the mentioned techniques with automation,
image management, networking, and data volumes, providing an easier and more complete experience for
developing and deploying containerized applications. Docker, in particular, uses the set of
technologies mentioned in this article to create and manage containers but also provides a
high-level abstraction layer that makes creating, sharing, and running containers much easier. It
uses an image system, registries, and specific commands to streamline the process. In short, while
understanding these fundamental principles is valuable for</p>
<p>DevOps professionals and sysadmins, the use of tools like Docker has made container adoption much
more accessible and productive for most developers and system administrators.</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    Â©  2019 -
     2025  Valdir Junior    <a></a> <a></a> 
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
