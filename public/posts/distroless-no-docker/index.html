<!DOCTYPE html>
<html lang="en">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <title>
  Docker Distroless: Healthchecks and Auto-Restart Â· Valdir Junior
</title>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">




<meta name="author" content="Valdir Junior">
<meta name="description" content="uncovering the power of Distroless images in Docker, focusing on security and monitoring with healthchecks and auto-restart capabilities.">
<meta name="keywords" content="devops, cloud, kubernetes, docker, linux, ansible, terraform, python, aws, azure">



  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Docker Distroless: Healthchecks and Auto-Restart">
  <meta name="twitter:description" content="uncovering the power of Distroless images in Docker, focusing on security and monitoring with healthchecks and auto-restart capabilities.">

<meta property="og:url" content="http://localhost:1313/posts/distroless-no-docker/">
  <meta property="og:site_name" content="Valdir Junior">
  <meta property="og:title" content="Docker Distroless: Healthchecks and Auto-Restart">
  <meta property="og:description" content="uncovering the power of Distroless images in Docker, focusing on security and monitoring with healthchecks and auto-restart capabilities.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-02-02T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-02-02T00:00:00+00:00">
    <meta property="article:tag" content="Docker">
    <meta property="article:tag" content="Distroless">
    <meta property="article:tag" content="Healthchecks">
    <meta property="article:tag" content="Auto-Restart">




<link rel="canonical" href="http://localhost:1313/posts/distroless-no-docker/">


<link rel="preload" href="/fonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/fonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.css" media="screen">






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.css" media="screen">
  



 




<link rel="icon" type="image/svg+xml" href="/images/favicon.svg" sizes="any">
<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">









</head>






<body class="preload-transitions colorscheme-auto">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa-solid fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    
    <a class="navigation-title" href="http://localhost:1313/">
      Valdir Junior
    </a>
    
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa-solid fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link " href="/about/">About</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/posts/">Publications</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/projects/">Experience</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link " href="/valdir-junior.pdf">Curriculum</a>
            </li>
          
        
        
          
          
          
            
              
                <li class="navigation-item menu-separator">
                  <span>|</span>
                </li>
                
              
              <li class="navigation-item">
                <a href="/pt-br/posts/distroless-no-docker/">ðŸ‡§ðŸ‡·</a>
              </li>
            
          
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://localhost:1313/posts/distroless-no-docker/">
              Docker Distroless: Healthchecks and Auto-Restart
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa-solid fa-calendar" aria-hidden="true"></i>
              <time datetime="2024-02-02T00:00:00Z">
                February 2, 2024
              </time>
            </span>
            <span class="reading-time">
              <i class="fa-solid fa-clock" aria-hidden="true"></i>
              3-minute read
            </span>
          </div>
          
          <div class="categories">
  <i class="fa-solid fa-folder" aria-hidden="true"></i>
    <a href="/categories/devops/">DevOps</a>
      <span class="separator">â€¢</span>
    <a href="/categories/containers/">Containers</a>
      <span class="separator">â€¢</span>
    <a href="/categories/linux/">Linux</a></div>

          <div class="tags">
  <i class="fa-solid fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/docker/">Docker</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/distroless/">Distroless</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/healthchecks/">Healthchecks</a>
    </span>
      <span class="separator">â€¢</span>
    <span class="tag">
      <a href="/tags/auto-restart/">Auto-Restart</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p><img src="https://media.licdn.com/dms/image/v2/D4E12AQGwhxdbDGnDjA/article-cover_image-shrink_720_1280/article-cover_image-shrink_720_1280/0/1696490979793?e=1758758400&amp;v=beta&amp;t=ImtknOIDkgq-8dIyXQIsdUdtaiwKKM6Cty88-4Ina9M" alt=""></p>
<h2 id="simplifying-container-image-efficiency">
  Simplifying Container Image Efficiency
  <a class="heading-link" href="#simplifying-container-image-efficiency">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="distroless-what-they-are-and-why-they-matter">
  Distroless: What They Are and Why They Matter
  <a class="heading-link" href="#distroless-what-they-are-and-why-they-matter">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Distroless images are a special class of Docker images that stand out for their minimalist approach.</p>
<p>Unlike traditional images that include a full operating system, distroless images contain only what
is necessary to run an application. This means there are no unnecessary packages or utilities, which
significantly reduces the containerâ€™s attack surface.</p>
<p>The importance of distroless images is twofold. First, they reduce the amount of potentially
vulnerable software present in the container. Second, they make containers lighter and faster to
deploy, saving hardware resources and improving scalability.</p>
<p>To inspect the layers of a distroless image and ensure its provenance, you can use the <code>dive</code> tool.</p>
<p><a href="https://gochronicles.com/dive/"  class="external-link" target="_blank" rel="noopener">Dive - Analyze Docker Images (</a><a href="http://gochronicles.com/"  class="external-link" target="_blank" rel="noopener">gochronicles.com</a><a href="https://gochronicles.com/dive/"  class="external-link" target="_blank" rel="noopener">)</a></p>
<p>It allow you to inspect an image&rsquo;s layers and check for any unwanted content.</p>
<p>For example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-zsh" data-lang="zsh"><span class="line"><span class="cl">dive gcr.io/distroless/base-debian10
</span></span></code></pre></div><hr>
<h3 id="healthchecks-keeping-the-container-healthy">
  Healthchecks: Keeping the Container Healthy
  <a class="heading-link" href="#healthchecks-keeping-the-container-healthy">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Now that we know how to make our containers more secure with distroless images, itâ€™s time to add
another layer of robustness: <code>healthchecks</code>.</p>
<p>A healthcheck is a function that verifies whether the container is in a healthy and functional
state. This is essential for monitoring and ensuring the continuous availability of your
application.</p>
<p>Healthchecks can be implemented directly in the Dockerfile. Hereâ€™s an example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># Use a distroless base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> gcr.io/distroless/base-debian10</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy application files into the container</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> my_app /my_app<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the port your application listens on</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 8080</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add a healthcheck</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">HEALTHCHECK</span> --interval<span class="o">=</span>5s --timeout<span class="o">=</span>3s <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="k">CMD</span> curl -f http://localhost:8080/health <span class="o">||</span> <span class="nb">exit</span> <span class="m">1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Command to start your application</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;/my_app&#34;</span><span class="p">]</span><span class="err">
</span></span></span></code></pre></div><p>In this example, we use the HEALTHCHECK instruction to define a health check that runs the curl
command to verify whether our applicationâ€™s /health endpoint is responding correctly. If the health
check fails, the container will be marked as unhealthy and can be restarted automatically.</p>
<hr>
<h3 id="automatic-restart-with-healthchecks">
  Automatic Restart with Healthchecks
  <a class="heading-link" href="#automatic-restart-with-healthchecks">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>One of the benefits of healthchecks is automatic restart. When you use container orchestrators like
Kubernetes, Docker Compose, or Swarm, they can monitor healthcheck statuses and take automatic
action when a container becomes unhealthy.</p>
<p>For example, in Kubernetes, you can specify the restart policy for your pods:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Pod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-app-container</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">minha-imagem:tag</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/health</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span></code></pre></div><p>In this example, Kubernetes monitors the containerâ€™s /health endpoint and automatically restarts the
pod if the health check fails. This ensures your application is always running and healthy.</p>
<p>Refer. DocumentaÃ§Ã£o Kubernetes.</p>
<p><img src="https://media.licdn.com/dms/image/v2/D4E12AQEya34_r8_tAQ/article-inline_image-shrink_1500_2232/article-inline_image-shrink_1500_2232/0/1696491718381?e=1758758400&amp;v=beta&amp;t=K4LJm_aPtT5kovSuXgS9yAZuYR1H-UURoVtD46GcQd0" alt="Article content"></p>
<p>Configure Liveness, Readiness and Startup Probes | Kubernetes</p>
<hr>
<h3 id="conclusion">
  Conclusion
  <a class="heading-link" href="#conclusion">
    <i class="fa-solid fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Security and monitoring are crucial elements for the success of containers in production
environments.</p>
<p>Using distroless images, implementing healthchecks, and properly customizing your Dockerfile or
Kubernetes YAML are best practices to achieve these goals.</p>
<p>By minimizing the attack surface, maintaining control over container health, and leveraging
automatic restarts, you take important steps toward a more secure and reliable container
architecture.</p>
<p>Always remember to adapt these practices to the specific needs of your application and environment.</p>

      </div>


      <footer>
        


        
        
        
        
        
        
        
      </footer>
    </article>

    
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    Â©  2019 -
     2025  Valdir Junior    <a></a> <a></a> 
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.js"></script>
  

  

  


  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
</body>
</html>
